<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="SNAC Saxon Extensions : Saxon HE Extensions for use with SNAC" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>SNAC Saxon Extensions</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/deternitydx/SNAC-Saxon-Extensions">View on GitHub</a>

          <h1 id="project_title">SNAC Saxon Extensions</h1>
          <h2 id="project_tagline">Saxon HE Extensions for use with SNAC</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/deternitydx/SNAC-Saxon-Extensions/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/deternitydx/SNAC-Saxon-Extensions/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <p>Saxon HE Extensions for use with the SNAC project.  Includes Java parsers for human written dates and geographical names.  Serves as a sample for creating other extensions to Saxon without the built-in Saxon libraries.</p>

<h2>
<a name="documentation" class="anchor" href="#documentation"><span class="octicon octicon-link"></span></a>Documentation</h2>

<p>JavaDoc documentation is available <a href="http://deternitydx.github.io/SNAC-Saxon-Extensions/javadoc/" title="JavaDoc Documentation">here</a>.</p>

<h2>
<a name="installation" class="anchor" href="#installation"><span class="octicon octicon-link"></span></a>Installation</h2>

<h3>
<a name="java-dependencies" class="anchor" href="#java-dependencies"><span class="octicon octicon-link"></span></a>Java Dependencies</h3>

<p>The following JAR files are required to build and run the date and GeoNames parser extensions.  Using the links below, download and unzip (as necessary) the JAR files into a common place:</p>

<ul>
<li>We provide extensions to Saxon HE, so you must install the full Saxon library. Saxon 9.5+ HE (the free version of Saxon) can be downloaded from the <a href="http://sourceforge.net/projects/saxon/files/" title="Saxon Download Page">Saxon website</a>.</li>
<li>Compiling the code with the Java date parser extension requires the Apache Commons Library to handle some date-parsing functionality.  Apache Commons is made freely available <a href="http://commons.apache.org/proper/commons-lang/download_lang.cgi" title="Apache Commons">here</a>.</li>
<li>The GeoNames parsing extension requires Berkeley's Cheshire to be installed.  Our extensions can be compiled and run without Cheshire, but the GeoNames portion will not function without it.  See the Cheshire Install instructions below to get Cheshire fully up and running with GeoNames.</li>
</ul><h3>
<a name="installing" class="anchor" href="#installing"><span class="octicon octicon-link"></span></a>Installing</h3>

<p>To install the Saxon extensions, you need only download and compile our source code.  We provide an ant script to aid in compilation.  This may be completed with the following steps:</p>

<ol>
<li>Download the SNAC Saxon Extensions (link at the top of the page) and unzip</li>
<li>Download and unzip the Saxon 9.5+ HE JAR files</li>
<li>Download and unzip the Apache Commons JAR files</li>
<li>Download and install the latest Java JDK.  On an Ubuntu Linux system, this may be achieved using the following command: <code>sudo apt-get install default-jdk ant</code>.</li>
<li>
<p>Compile extensions into executable JAR file.  The easiest way to install is using our Apache Ant script.  Copy the Saxon and Commons JAR files to the <code>/java/lib</code> folder in <code>SNAC-Saxon-Extensions</code>, then run <code>ant</code> as follows:</p>

<pre><code>&gt; cd SNAC-Saxon-Extensions/java
&gt; cp /path/to/saxon9he.jar lib/saxon9he.jar
&gt; cp /path/to/commons-lang3-3.x.jar lib/commons-lang3.jar
&gt; ant
</code></pre>
</li>
<li>Once the JAR file is built, execute using the new JAR file instead of the original Saxon saxon9he.jar file. For example: <code>java -jar snacTransform.jar /path/to/XMLfile /path/to/XSLTfile</code>
</li>
</ol><h2>
<a name="using-the-new-saxon-extensions" class="anchor" href="#using-the-new-saxon-extensions"><span class="octicon octicon-link"></span></a>Using the new Saxon extensions</h2>

<h3>
<a name="date-parser" class="anchor" href="#date-parser"><span class="octicon octicon-link"></span></a>Date Parser</h3>

<p>See the xslt/date.xsl file for a sample.  The xslt wrappers for the Java methods are available in xslt/lib/.</p>

<h3>
<a name="geonames-parser" class="anchor" href="#geonames-parser"><span class="octicon octicon-link"></span></a>GeoNames Parser</h3>

<p>See xslt/place.xsl for a sample on how to use the parsing library.  The xslt wrappers for the Java methods are available in xslt/lib/.</p>

<h2>
<a name="installing-cheshire" class="anchor" href="#installing-cheshire"><span class="octicon octicon-link"></span></a>Installing Cheshire</h2>

<p>Cheshire is more complicated to install and set up as a service on your machine.  The instructions below are provided for Linux users.</p>

<ol>
<li>Download and compile the Cheshire binaries.  They can be found at the <a href="http://cheshire.berkeley.edu/Downloads/" title="Cheshire Downloads">Cheshire homepage</a>.  You will need a C compiler.</li>
<li>Download the GeoNames data from their <a href="http://www.geonames.org/" title="GeoNames">website</a>.  This requires a subscription fee to get access to the Premium Data.  Unzip the xml files into a directory, such as <code>GeoNames/data</code>.</li>
<li>Build indexes for the GeoNames data.<br><ol>
<li>First, set up a config file.  A sample can be found <a href="config-files/geonames_config.txt">here</a>.  Specifically, note the first few configs:

<ul>
<li>
<code>&lt;DBENV&gt; /full/root/path/to/GeoNames/dbenv &lt;/DBENV&gt;</code> defines the location to the database environment.  This directory, <code>dbenv</code> must be world readable AND writable.</li>
<li>
<code>&lt;defaultpath&gt; /full/root/path/to/GeoNames &lt;/defaultpath&gt;</code> defines the full path to the base directory of cheshire.  This should include the <code>dbenv</code> directory, config, data, etc.</li>
<li>
<code>&lt;FILENAME&gt; data &lt;/FILENAME&gt;</code> defines the directory (or file) where all the geonames data lives.  In this example, the data would be stored in <code>/full/root/path/to/GeoNames/data</code>.</li>
<li>
<code>&lt;ASSOCFIL&gt; assoc/geonames_all &lt;/ASSOCFIL&gt;</code> defines the associator file.  This is built early on before indexing.  Note that here it is inside the <code>assoc</code> directory.</li>
</ul>
</li>
<li>Build the associator file.

<ul>
<li>
<code>&gt; buildassoc -r data assoc/geonames_all row</code>, since we want to build the associator for the <code>data</code> directory and use GeoName's entry divider, <code>&lt;row&gt;</code>.</li>
</ul>
</li>
<li>Build the indexes for cheshire.

<ul>
<li>
<code>&gt; index_cheshire -b -L logfile.txt geonames_config.txt</code>, which will take a long time.  If you use the sample file provided, it will produce all the indexes needed for the Saxon extension. </li>
</ul>
</li>
</ol>
</li>
<li>Set up the Cheshire server, <code>jserver</code>.

<ol>
<li>Set up the Jserver config file, which tells the port number, cheshire index config file, location to data, etc.  A sample is provided <a href="config-files/server_config.txt">here</a>.  The only config options that need to be set from the default are:

<ul>
<li>
<code>DATABASE_NAMES         "data"</code> the location of the data files.</li>
<li>
<code>DATABASE_DIRECTORIES   "/full/path/to/basedir/GeoNames"</code> the full path to where the data files (and other config information) is stored.  This should be the same as above.</li>
<li>
<code>DATABASE_CONFIGFILES   "/full/path/to/config/geonames_config.txt"</code> config file from above.</li>
</ul>
</li>
<li>Install xinetd from your repository.  For Ubuntu, you can use the command <code>sudo apt-get install xinetd</code>.</li>
<li>Add Jserver to the xinetd config by saving the xinetd config file <a href="config-files/xinetd_config.txt">here</a> to the <code>/etc/xinetd.d/</code> directory and removing the <code>.txt</code> extension.  Change the following lines in the config file to match your configuration:

<ul>
<li>
<code>server          = /usr/bin/jserver</code> full path of the jserver binary</li>
<li>
<code>server_args     = -c /full/path/to/jserver/config/server_config.txt</code> full path of the jserver config file (note the <code>-c</code> command option)</li>
</ul>
</li>
<li>Restart xinetd. On Ubuntu, this command is <code>service xinetd restart</code>.</li>
<li>Test your system by telneting to port 7010.  You should be prompted by jserver.</li>
</ol>
</li>
</ol>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">SNAC Saxon Extensions maintained by <a href="https://github.com/deternitydx">deternitydx</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
